name: 🚀 Desplegar en Netlify
on:
    push:
        branches: [ main ]
    pull_request:
        branches: [ main ]
        

jobs:
    test:
        name: Ejecutar pruebas
        runs-on: ubuntu-latest
        steps:
            - name: 📥 Descargar código
              uses: actions/checkout@v4
            - name: ⚙️ Configurar Node.js
              uses: actions/setup-node@v4
              with:
                node-version: '18'
            - name: Instalar dependencias
              run: |
                echo "Instalando dependencias..."
                npm install
            - name: 🧪 Ejecutar pruebas
              run: |
                echo "Ejecutando pruebas...": 
                npm test
    deploy:
        name: 🚀 Desplegar en Netlify
        needs: test
        runs-on: ubuntu-latest
        if: github.ref == 'refs/heads/main' && github.event_name == 'push'
        steps:
            - name: 📥 Descargar código
              uses: actions/checkout@v4
            - name: ⚙️ Configurar Node.js
              uses: actions/setup-node@v4
              with:
                node-version: '18'
            - name: 🏗️ Construir aplicación
              run: |
                echo "Construyendo el proyecto..."
                npm run build
            - name: 🚀 Desplegar en Netlify
              uses: nwtgck/actions-netlify@3.0
              with:
                publish-dir: './dist'
                production-branch: 'main'
                github-token: ${{ secrets.GITHUB_TOKEN }}
                deploy-message: "Deploy from GitHub Actions"
                enable-pull-request-comment: false
                enable-commit-comment: true
                overwrites-pull-request-comment: true
              env:
                netlify-auth-token: ${{ secrets.NETLIFY_AUTH_TOKEN }}
                netlify-site-id: ${{ secrets.NETLIFY_SITE_ID }}
              timeout-minutes: 1